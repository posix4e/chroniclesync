var U=Object.defineProperty;var A=(m,e,t)=>e in m?U(m,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):m[e]=t;var u=(m,e,t)=>A(m,typeof e!="symbol"?e+"":e,t);import{_ as M}from"./preload-helper-D7HrI6pR.js";class _{constructor(){u(this,"config",null);u(this,"PROD_API_URL","https://api.chroniclesync.xyz");u(this,"STAGING_API_URL","https://api-staging.chroniclesync.xyz");u(this,"bip39WordList",null);u(this,"DEFAULT_SETTINGS",{mnemonic:"",clientId:"",customApiUrl:null,environment:"production",expirationDays:7,summary:{enabled:!0,summaryLength:30,minSentences:3,maxSentences:10,autoSummarize:!0,contentPriority:{headlines:!0,lists:!0,quotes:!1},modelConfig:{modelUrl:"https://tfhub.dev/tensorflow/tfjs-model/universal-sentence-encoder-lite/1/default/1",inputLength:512,outputLength:512,threshold:.3}}})}async init(){try{const{wordList:t}=await M(async()=>{const{wordList:n}=await import("./bip39-wordlist-DFmiuV3D.js");return{wordList:n}},[]);this.bip39WordList=t}catch(t){console.error("Error loading wordlist:",t);return}const e=await this.getStorageData();if(this.config={mnemonic:e.mnemonic||this.DEFAULT_SETTINGS.mnemonic,clientId:e.clientId||this.DEFAULT_SETTINGS.clientId,customApiUrl:e.customApiUrl||this.DEFAULT_SETTINGS.customApiUrl,environment:e.environment||this.DEFAULT_SETTINGS.environment,expirationDays:e.expirationDays||this.DEFAULT_SETTINGS.expirationDays,summary:e.summary||this.DEFAULT_SETTINGS.summary},!this.config.mnemonic||!this.config.clientId){const t=this.generateMnemonic();if(t){const n=await this.generateClientId(t);this.config={...this.config,mnemonic:t,clientId:n},await this.handleSave()}}this.render(),this.setupEventListeners()}generateMnemonic(){if(!this.bip39WordList)return null;const e=new Uint8Array(32);crypto.getRandomValues(e);const t=[];for(let n=0;n<24;n++){const i=Math.floor(e[n]/256*this.bip39WordList.length);t.push(this.bip39WordList[i])}return t.join(" ")}validateMnemonic(e){if(!this.bip39WordList)return!1;const t=e.trim().toLowerCase().split(/\s+/);return t.length!==24?!1:t.every(n=>this.bip39WordList.includes(n))}async generateClientId(e){const n=new TextEncoder().encode(e),i=await crypto.subtle.digest("SHA-256",n);return Array.from(new Uint8Array(i)).map(s=>s.toString(16).padStart(2,"0")).join("")}async getStorageData(){return new Promise(e=>{const t=["mnemonic","clientId","customApiUrl","environment","expirationDays","summary"];chrome.storage.sync.get(t,n=>e(n))})}getApiUrl(){if(!this.config)throw new Error("Settings not initialized");switch(this.config.environment){case"production":return this.PROD_API_URL;case"staging":return this.STAGING_API_URL;case"custom":return this.config.customApiUrl||this.PROD_API_URL;default:return this.PROD_API_URL}}render(){if(!this.config)return;const e=document.getElementById("mnemonic"),t=document.getElementById("clientId"),n=document.getElementById("environment"),i=document.getElementById("customUrlContainer"),o=document.getElementById("customApiUrl"),s=document.getElementById("expirationDays");e.value=this.config.mnemonic,t.value=this.config.clientId,n.value=this.config.environment,o.value=this.config.customApiUrl||"",s.value=this.config.expirationDays.toString(),i.style.display=this.config.environment==="custom"?"block":"none";const r=document.getElementById("summaryEnabled"),l=document.getElementById("autoSummarize"),h=document.getElementById("summaryLength"),g=document.getElementById("minSentences"),f=document.getElementById("maxSentences"),c=document.getElementById("priorityHeadlines"),a=document.getElementById("priorityLists"),d=document.getElementById("priorityQuotes"),E=document.getElementById("modelUrl"),v=document.getElementById("inputLength"),S=document.getElementById("outputLength"),y=document.getElementById("threshold");this.config.summary&&(r.checked=this.config.summary.enabled,l.checked=this.config.summary.autoSummarize,h.value=this.config.summary.summaryLength.toString(),g.value=this.config.summary.minSentences.toString(),f.value=this.config.summary.maxSentences.toString(),c.checked=this.config.summary.contentPriority.headlines,a.checked=this.config.summary.contentPriority.lists,d.checked=this.config.summary.contentPriority.quotes,E.value=this.config.summary.modelConfig.modelUrl,v.value=this.config.summary.modelConfig.inputLength.toString(),S.value=this.config.summary.modelConfig.outputLength.toString(),y.value=this.config.summary.modelConfig.threshold.toString())}setupEventListeners(){var e,t,n,i,o,s;(e=document.getElementById("saveSettings"))==null||e.addEventListener("click",r=>this.handleSave(r)),(t=document.getElementById("resetSettings"))==null||t.addEventListener("click",()=>this.handleReset()),(n=document.getElementById("environment"))==null||n.addEventListener("change",()=>this.handleEnvironmentChange()),(i=document.getElementById("generateMnemonic"))==null||i.addEventListener("click",()=>this.handleGenerateMnemonic()),(o=document.getElementById("showMnemonic"))==null||o.addEventListener("click",()=>this.handleShowMnemonic()),(s=document.getElementById("mnemonic"))==null||s.addEventListener("input",()=>this.handleMnemonicInput())}async handleMnemonicInput(){const e=document.getElementById("mnemonic"),t=document.getElementById("clientId");if(!e||!t)return;const n=e.value.trim();if(this.validateMnemonic(n)){const i=await this.generateClientId(n);t.value=i,this.config={...this.config,mnemonic:n,clientId:i}}else t.value=""}handleShowMnemonic(){const e=document.getElementById("mnemonic");e&&e.classList.toggle("hidden")}async handleGenerateMnemonic(){const e=document.getElementById("mnemonic");if(!e)return;const t=this.generateMnemonic();t&&(e.value=t,await this.handleMnemonicInput(),await this.handleSave())}handleEnvironmentChange(){const e=document.getElementById("environment"),t=document.getElementById("customUrlContainer");t.style.display=e.value==="custom"?"block":"none"}async handleSave(e){e==null||e.preventDefault();const t=document.getElementById("mnemonic"),n=document.getElementById("clientId"),i=document.getElementById("environment"),o=document.getElementById("customApiUrl"),s=document.getElementById("expirationDays"),r=t.value.trim();if(!this.validateMnemonic(r)){this.showMessage("Please enter a valid 24-word mnemonic phrase","error");return}const l=parseInt(s.value);if(isNaN(l)||l<1){this.showMessage("Please enter a valid number of days for expiration (minimum 1)","error");return}const h=await this.generateClientId(r);n.value=h;const g=document.getElementById("summaryEnabled").checked,f=document.getElementById("autoSummarize").checked,c=parseInt(document.getElementById("summaryLength").value),a=parseInt(document.getElementById("minSentences").value),d=parseInt(document.getElementById("maxSentences").value),E=document.getElementById("priorityHeadlines").checked,v=document.getElementById("priorityLists").checked,S=document.getElementById("priorityQuotes").checked,y=document.getElementById("modelUrl").value.trim(),L=parseInt(document.getElementById("inputLength").value),w=parseInt(document.getElementById("outputLength").value),I=parseFloat(document.getElementById("threshold").value);if(g){if(isNaN(c)||c<1||c>100){this.showMessage("Summary length must be between 1 and 100","error");return}if(isNaN(a)||a<1){this.showMessage("Minimum sentences must be at least 1","error");return}if(isNaN(d)||d<a){this.showMessage("Maximum sentences must be greater than or equal to minimum sentences","error");return}if(!y){this.showMessage("Model URL is required when summarization is enabled","error");return}if(isNaN(L)||L<1){this.showMessage("Input length must be at least 1","error");return}if(isNaN(w)||w<1){this.showMessage("Output length must be at least 1","error");return}if(isNaN(I)||I<0||I>1){this.showMessage("Threshold must be between 0 and 1","error");return}}const p={mnemonic:r,clientId:h,environment:i.value,customApiUrl:i.value==="custom"?o.value.trim():null,expirationDays:l,summary:{enabled:g,autoSummarize:f,summaryLength:c,minSentences:a,maxSentences:d,contentPriority:{headlines:E,lists:v,quotes:S},modelConfig:{modelUrl:y,inputLength:L,outputLength:w,threshold:I}}};if(p.environment==="custom"&&!p.customApiUrl){this.showMessage("Custom API URL is required when using custom environment","error");return}await new Promise(B=>{chrome.storage.sync.set(p,()=>B())}),this.config=p,this.showMessage("Settings saved successfully!","success")}async handleReset(){if(confirm("Are you sure you want to reset all settings to default values?")){const e=this.generateMnemonic();if(e){const t=await this.generateClientId(e);this.config={...this.DEFAULT_SETTINGS,mnemonic:e,clientId:t},this.render(),await this.handleSave()}}}showMessage(e,t){var i;const n=document.createElement("div");n.className=`status-message ${t}`,n.textContent=e,(i=document.querySelector(".settings-actions"))==null||i.appendChild(n),setTimeout(()=>{n.remove()},3e3)}}export{_ as Settings};
