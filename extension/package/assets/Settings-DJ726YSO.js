var L=Object.defineProperty;var A=(a,e,t)=>e in a?L(a,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):a[e]=t;var h=(a,e,t)=>A(a,typeof e!="symbol"?e+"":e,t);const U="modulepreload",B=function(a){return"/"+a},S={},T=function(e,t,n){let i=Promise.resolve();if(t&&t.length>0){document.getElementsByTagName("link");const s=document.querySelector("meta[property=csp-nonce]"),o=(s==null?void 0:s.nonce)||(s==null?void 0:s.getAttribute("nonce"));i=Promise.allSettled(t.map(c=>{if(c=B(c),c in S)return;S[c]=!0;const u=c.endsWith(".css"),g=u?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${c}"]${g}`))return;const r=document.createElement("link");if(r.rel=u?"stylesheet":U,u||(r.as="script"),r.crossOrigin="",r.href=c,o&&r.setAttribute("nonce",o),document.head.appendChild(r),u)return new Promise((l,d)=>{r.addEventListener("load",l),r.addEventListener("error",()=>d(new Error(`Unable to preload CSS for ${c}`)))})}))}function m(s){const o=new Event("vite:preloadError",{cancelable:!0});if(o.payload=s,window.dispatchEvent(o),!o.defaultPrevented)throw s}return i.then(s=>{for(const o of s||[])o.status==="rejected"&&m(o.reason);return e().catch(m)})},I={enabled:!0,summaryLength:30,minSentences:3,maxSentences:10,autoSummarize:!0,contentPriority:{headlines:!0,lists:!0,quotes:!1},modelConfig:{modelUrl:"https://tfhub.dev/tensorflow/tfjs-model/universal-sentence-encoder-lite/1/default/1",inputLength:512,outputLength:512,threshold:.3}};class M{constructor(){h(this,"config",null);h(this,"PROD_API_URL","https://api.chroniclesync.xyz");h(this,"STAGING_API_URL","https://api-staging.chroniclesync.xyz");h(this,"bip39WordList",null);h(this,"DEFAULT_SETTINGS",{mnemonic:"",clientId:"",customApiUrl:null,environment:"production",expirationDays:7,summarySettings:I})}async init(){try{const n=(await T(()=>import("./wordlist-DFmiuV3D.js"),[])).wordList;this.bip39WordList=typeof n=="string"?n.split(`
`):n}catch(t){console.error("Error loading wordlist:",t);return}const e=await this.getStorageData();if(this.config={mnemonic:e.mnemonic||this.DEFAULT_SETTINGS.mnemonic,clientId:e.clientId||this.DEFAULT_SETTINGS.clientId,customApiUrl:e.customApiUrl||this.DEFAULT_SETTINGS.customApiUrl,environment:e.environment||this.DEFAULT_SETTINGS.environment,expirationDays:e.expirationDays||this.DEFAULT_SETTINGS.expirationDays,summarySettings:e.summarySettings||this.DEFAULT_SETTINGS.summarySettings},!this.config.mnemonic||!this.config.clientId){const t=this.generateMnemonic();if(t){const n=await this.generateClientId(t);this.config={...this.config,mnemonic:t,clientId:n},await this.handleSave()}}this.render(),this.setupEventListeners()}generateMnemonic(){if(!this.bip39WordList)return null;const e=new Uint8Array(32);crypto.getRandomValues(e);const t=[];for(let n=0;n<24;n++){const i=Math.floor(e[n]/256*this.bip39WordList.length);t.push(this.bip39WordList[i])}return t.join(" ")}validateMnemonic(e){if(!this.bip39WordList)return!1;const t=e.trim().toLowerCase().split(/\s+/);return t.length!==24?!1:t.every(n=>this.bip39WordList.includes(n))}async generateClientId(e){const n=new TextEncoder().encode(e),i=await crypto.subtle.digest("SHA-256",n);return Array.from(new Uint8Array(i)).map(s=>s.toString(16).padStart(2,"0")).join("")}async getStorageData(){return new Promise(e=>{const t=["mnemonic","clientId","customApiUrl","environment","expirationDays","summarySettings"];chrome.storage.sync.get(t,n=>e(n))})}getApiUrl(){if(!this.config)throw new Error("Settings not initialized");switch(this.config.environment){case"production":return this.PROD_API_URL;case"staging":return this.STAGING_API_URL;case"custom":return this.config.customApiUrl||this.PROD_API_URL;default:return this.PROD_API_URL}}render(){if(!this.config)return;const e=document.getElementById("mnemonic"),t=document.getElementById("clientId"),n=document.getElementById("environment"),i=document.getElementById("customUrlContainer"),m=document.getElementById("customApiUrl"),s=document.getElementById("expirationDays"),o=document.getElementById("summaryEnabled"),c=document.getElementById("summaryLength"),u=document.getElementById("minSentences"),g=document.getElementById("maxSentences"),r=document.getElementById("autoSummarize"),l=document.getElementById("priorityHeadlines"),d=document.getElementById("priorityLists"),p=document.getElementById("priorityQuotes");e.value=this.config.mnemonic,t.value=this.config.clientId,n.value=this.config.environment,m.value=this.config.customApiUrl||"",s.value=this.config.expirationDays.toString(),i.style.display=this.config.environment==="custom"?"block":"none",o.checked=this.config.summarySettings.enabled,c.value=this.config.summarySettings.summaryLength.toString(),u.value=this.config.summarySettings.minSentences.toString(),g.value=this.config.summarySettings.maxSentences.toString(),r.checked=this.config.summarySettings.autoSummarize,l.checked=this.config.summarySettings.contentPriority.headlines,d.checked=this.config.summarySettings.contentPriority.lists,p.checked=this.config.summarySettings.contentPriority.quotes}setupEventListeners(){var e,t,n,i,m,s;(e=document.getElementById("saveSettings"))==null||e.addEventListener("click",o=>this.handleSave(o)),(t=document.getElementById("resetSettings"))==null||t.addEventListener("click",()=>this.handleReset()),(n=document.getElementById("environment"))==null||n.addEventListener("change",()=>this.handleEnvironmentChange()),(i=document.getElementById("generateMnemonic"))==null||i.addEventListener("click",()=>this.handleGenerateMnemonic()),(m=document.getElementById("showMnemonic"))==null||m.addEventListener("click",()=>this.handleShowMnemonic()),(s=document.getElementById("mnemonic"))==null||s.addEventListener("input",()=>this.handleMnemonicInput())}async handleMnemonicInput(){const e=document.getElementById("mnemonic"),t=document.getElementById("clientId");if(!e||!t)return;const n=e.value.trim();if(this.validateMnemonic(n)){const i=await this.generateClientId(n);t.value=i,this.config={...this.config,mnemonic:n,clientId:i}}else t.value=""}handleShowMnemonic(){const e=document.getElementById("mnemonic");e&&e.classList.toggle("hidden")}async handleGenerateMnemonic(){const e=document.getElementById("mnemonic");if(!e)return;const t=this.generateMnemonic();t&&(e.value=t,await this.handleMnemonicInput(),await this.handleSave())}handleEnvironmentChange(){const e=document.getElementById("environment"),t=document.getElementById("customUrlContainer");t.style.display=e.value==="custom"?"block":"none"}async handleSave(e){e==null||e.preventDefault();const t=document.getElementById("mnemonic"),n=document.getElementById("clientId"),i=document.getElementById("environment"),m=document.getElementById("customApiUrl"),s=document.getElementById("expirationDays"),o=t.value.trim();if(!this.validateMnemonic(o)){this.showMessage("Please enter a valid 24-word mnemonic phrase","error");return}const c=parseInt(s.value);if(isNaN(c)||c<1){this.showMessage("Please enter a valid number of days for expiration (minimum 1)","error");return}const u=await this.generateClientId(o);n.value=u;const g=document.getElementById("summaryEnabled").checked,r=parseInt(document.getElementById("summaryLength").value),l=parseInt(document.getElementById("minSentences").value),d=parseInt(document.getElementById("maxSentences").value),p=document.getElementById("autoSummarize").checked,f=document.getElementById("priorityHeadlines").checked,E=document.getElementById("priorityLists").checked,v=document.getElementById("priorityQuotes").checked;if(isNaN(r)||r<10||r>100){this.showMessage("Summary length must be between 10 and 100 words","error");return}if(isNaN(l)||l<1||l>10){this.showMessage("Minimum sentences must be between 1 and 10","error");return}if(isNaN(d)||d<1||d>20){this.showMessage("Maximum sentences must be between 1 and 20","error");return}if(l>d){this.showMessage("Minimum sentences cannot be greater than maximum sentences","error");return}const y={mnemonic:o,clientId:u,environment:i.value,customApiUrl:i.value==="custom"?m.value.trim():null,expirationDays:c,summarySettings:{enabled:g,summaryLength:r,minSentences:l,maxSentences:d,autoSummarize:p,contentPriority:{headlines:f,lists:E,quotes:v},modelConfig:this.config.summarySettings.modelConfig}};if(y.environment==="custom"&&!y.customApiUrl){this.showMessage("Custom API URL is required when using custom environment","error");return}await new Promise(w=>{chrome.storage.sync.set(y,()=>w())}),this.config=y,chrome.runtime.sendMessage({type:"updateSummarySettings",settings:y.summarySettings}),this.showMessage("Settings saved successfully!","success")}async handleReset(){if(confirm("Are you sure you want to reset all settings to default values?")){const e=this.generateMnemonic();if(e){const t=await this.generateClientId(e);this.config={...this.DEFAULT_SETTINGS,mnemonic:e,clientId:t,summarySettings:I},this.render(),await this.handleSave(),chrome.runtime.sendMessage({type:"updateSummarySettings",settings:I})}}}showMessage(e,t){var i;const n=document.createElement("div");n.className=`status-message ${t}`,n.textContent=e,(i=document.querySelector(".settings-actions"))==null||i.appendChild(n),setTimeout(()=>{n.remove()},3e3)}}export{M as S};
