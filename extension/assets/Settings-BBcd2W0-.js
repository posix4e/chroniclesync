var I=Object.defineProperty;var y=(m,e,t)=>e in m?I(m,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):m[e]=t;var u=(m,e,t)=>y(m,typeof e!="symbol"?e+"":e,t);const f="modulepreload",v=function(m){return"/"+m},h={},E=function(e,t,n){let i=Promise.resolve();if(t&&t.length>0){document.getElementsByTagName("link");const o=document.querySelector("meta[property=csp-nonce]"),s=(o==null?void 0:o.nonce)||(o==null?void 0:o.getAttribute("nonce"));i=Promise.allSettled(t.map(r=>{if(r=v(r),r in h)return;h[r]=!0;const l=r.endsWith(".css"),d=l?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${r}"]${d}`))return;const a=document.createElement("link");if(a.rel=l?"stylesheet":f,l||(a.as="script"),a.crossOrigin="",a.href=r,s&&a.setAttribute("nonce",s),document.head.appendChild(a),l)return new Promise((g,p)=>{a.addEventListener("load",g),a.addEventListener("error",()=>p(new Error(`Unable to preload CSS for ${r}`)))})}))}function c(o){const s=new Event("vite:preloadError",{cancelable:!0});if(s.payload=o,window.dispatchEvent(s),!s.defaultPrevented)throw o}return i.then(o=>{for(const s of o||[])s.status==="rejected"&&c(s.reason);return e().catch(c)})};class S{constructor(){u(this,"config",null);u(this,"PROD_API_URL","https://api.chroniclesync.xyz");u(this,"STAGING_API_URL","https://api-staging.chroniclesync.xyz");u(this,"bip39WordList",null);u(this,"DEFAULT_SETTINGS",{mnemonic:"",clientId:"",customApiUrl:null,environment:"production",expirationDays:7})}async init(){try{const{wordList:t}=await E(async()=>{const{wordList:n}=await import("./bip39-wordlist-DFmiuV3D.js");return{wordList:n}},[]);this.bip39WordList=t}catch(t){console.error("Error loading wordlist:",t);return}const e=await this.getStorageData();if(this.config={mnemonic:e.mnemonic||this.DEFAULT_SETTINGS.mnemonic,clientId:e.clientId||this.DEFAULT_SETTINGS.clientId,customApiUrl:e.customApiUrl||this.DEFAULT_SETTINGS.customApiUrl,environment:e.environment||this.DEFAULT_SETTINGS.environment,expirationDays:e.expirationDays||this.DEFAULT_SETTINGS.expirationDays},!this.config.mnemonic||!this.config.clientId){const t=this.generateMnemonic();if(t){const n=await this.generateClientId(t);this.config={...this.config,mnemonic:t,clientId:n},await this.handleSave()}}this.render(),this.setupEventListeners()}generateMnemonic(){if(!this.bip39WordList)return null;const e=new Uint8Array(32);crypto.getRandomValues(e);const t=[];for(let n=0;n<24;n++){const i=Math.floor(e[n]/256*this.bip39WordList.length);t.push(this.bip39WordList[i])}return t.join(" ")}validateMnemonic(e){if(!this.bip39WordList)return!1;const t=e.trim().toLowerCase().split(/\s+/);return t.length!==24?!1:t.every(n=>this.bip39WordList.includes(n))}async generateClientId(e){const n=new TextEncoder().encode(e),i=await crypto.subtle.digest("SHA-256",n);return Array.from(new Uint8Array(i)).map(o=>o.toString(16).padStart(2,"0")).join("")}async getStorageData(){return new Promise(e=>{const t=["mnemonic","clientId","customApiUrl","environment","expirationDays"];chrome.storage.sync.get(t,n=>e(n))})}getApiUrl(){if(!this.config)throw new Error("Settings not initialized");switch(this.config.environment){case"production":return this.PROD_API_URL;case"staging":return this.STAGING_API_URL;case"custom":return this.config.customApiUrl||this.PROD_API_URL;default:return this.PROD_API_URL}}render(){if(!this.config)return;const e=document.getElementById("mnemonic"),t=document.getElementById("clientId"),n=document.getElementById("environment"),i=document.getElementById("customUrlContainer"),c=document.getElementById("customApiUrl"),o=document.getElementById("expirationDays");e.value=this.config.mnemonic,t.value=this.config.clientId,n.value=this.config.environment,c.value=this.config.customApiUrl||"",o.value=this.config.expirationDays.toString(),i.style.display=this.config.environment==="custom"?"block":"none"}setupEventListeners(){var e,t,n,i,c,o;(e=document.getElementById("saveSettings"))==null||e.addEventListener("click",s=>this.handleSave(s)),(t=document.getElementById("resetSettings"))==null||t.addEventListener("click",()=>this.handleReset()),(n=document.getElementById("environment"))==null||n.addEventListener("change",()=>this.handleEnvironmentChange()),(i=document.getElementById("generateMnemonic"))==null||i.addEventListener("click",()=>this.handleGenerateMnemonic()),(c=document.getElementById("showMnemonic"))==null||c.addEventListener("click",()=>this.handleShowMnemonic()),(o=document.getElementById("mnemonic"))==null||o.addEventListener("input",()=>this.handleMnemonicInput())}async handleMnemonicInput(){const e=document.getElementById("mnemonic"),t=document.getElementById("clientId");if(!e||!t)return;const n=e.value.trim();if(this.validateMnemonic(n)){const i=await this.generateClientId(n);t.value=i,this.config={...this.config,mnemonic:n,clientId:i}}else t.value=""}handleShowMnemonic(){const e=document.getElementById("mnemonic");e&&e.classList.toggle("hidden")}async handleGenerateMnemonic(){const e=document.getElementById("mnemonic");if(!e)return;const t=this.generateMnemonic();t&&(e.value=t,await this.handleMnemonicInput(),await this.handleSave())}handleEnvironmentChange(){const e=document.getElementById("environment"),t=document.getElementById("customUrlContainer");t.style.display=e.value==="custom"?"block":"none"}async handleSave(e){e==null||e.preventDefault();const t=document.getElementById("mnemonic"),n=document.getElementById("clientId"),i=document.getElementById("environment"),c=document.getElementById("customApiUrl"),o=document.getElementById("expirationDays"),s=t.value.trim();if(!this.validateMnemonic(s)){this.showMessage("Please enter a valid 24-word mnemonic phrase","error");return}const r=parseInt(o.value);if(isNaN(r)||r<1){this.showMessage("Please enter a valid number of days for expiration (minimum 1)","error");return}const l=await this.generateClientId(s);n.value=l;const d={mnemonic:s,clientId:l,environment:i.value,customApiUrl:i.value==="custom"?c.value.trim():null,expirationDays:r};if(d.environment==="custom"&&!d.customApiUrl){this.showMessage("Custom API URL is required when using custom environment","error");return}await new Promise(a=>{chrome.storage.sync.set(d,()=>a())}),this.config=d,this.showMessage("Settings saved successfully!","success")}async handleReset(){if(confirm("Are you sure you want to reset all settings to default values?")){const e=this.generateMnemonic();if(e){const t=await this.generateClientId(e);this.config={...this.DEFAULT_SETTINGS,mnemonic:e,clientId:t},this.render(),await this.handleSave()}}}showMessage(e,t){var i;const n=document.createElement("div");n.className=`status-message ${t}`,n.textContent=e,(i=document.querySelector(".settings-actions"))==null||i.appendChild(n),setTimeout(()=>{n.remove()},3e3)}}export{S,E as _};
