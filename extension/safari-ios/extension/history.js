import{r as t,j as e,c as F}from"./assets/client-DurQqVcw.js";import{H as D}from"./assets/HistoryStore-D4jEreiL.js";const M=({onSearchComplete:r})=>{const[d,a]=t.useState(""),[o,c]=t.useState(!1),[j,l]=t.useState(null),v=async u=>{if(u.preventDefault(),!d.trim()){l("Please enter a search term");return}c(!0),l(null);try{const h=await chrome.runtime.sendMessage({type:"searchHistory",query:d.trim()});h.error?l(h.error):h.success&&r(h.results)}catch(h){l("Failed to search history: "+String(h))}finally{c(!1)}};return e.jsx("div",{className:"search-container",children:e.jsxs("form",{onSubmit:v,children:[e.jsxs("div",{className:"search-input-container",children:[e.jsx("input",{type:"text",value:d,onChange:u=>a(u.target.value),placeholder:"Search page content...",className:"search-input"}),e.jsx("button",{type:"submit",className:"search-button",disabled:o,children:o?"Searching...":"Search"})]}),j&&e.jsx("div",{className:"search-error",children:j})]})})},_=({results:r,onClearResults:d})=>r.length===0?null:e.jsxs("div",{className:"search-results",children:[e.jsxs("div",{className:"search-results-header",children:[e.jsxs("h3",{children:["Search Results (",r.length,")"]}),e.jsx("button",{onClick:d,className:"clear-results-button",children:"Clear Results"})]}),e.jsx("div",{className:"search-results-list",children:r.map(a=>e.jsxs("div",{className:"search-result-item",children:[e.jsxs("div",{className:"search-result-title",children:[e.jsx("a",{href:a.url,target:"_blank",rel:"noopener noreferrer",children:a.title||a.url}),e.jsx("span",{className:"search-result-time",children:new Date(a.visitTime).toLocaleString()})]}),e.jsxs("div",{className:"search-result-matches",children:[a.matches.slice(0,3).map((o,c)=>e.jsx("div",{className:"search-result-match",children:e.jsx("div",{className:"search-result-context",children:o.context.replace(o.text,`<mark>${o.text}</mark>`)})},c)),a.matches.length>3&&e.jsxs("div",{className:"search-result-more",children:["+",a.matches.length-3," more matches"]})]})]},a.visitId))})]}),S=10,$=()=>{const[r,d]=t.useState([]),[a,o]=t.useState([]),[c,j]=t.useState(""),[l,v]=t.useState(1),[u,h]=t.useState(1),[m,C]=t.useState({platform:"",browserName:""}),[w,P]=t.useState([]),[E,R]=t.useState([]),[k,f]=t.useState([]),[x,p]=t.useState(!1);t.useEffect(()=>{I()},[]),t.useEffect(()=>{if(r.length>0){const s=[...new Set(r.map(i=>i.platform))],n=[...new Set(r.map(i=>i.browserName))];P(s),R(n)}},[r]),t.useEffect(()=>{if(x)return;const s=r.filter(n=>{const i=c===""||n.title.toLowerCase().includes(c.toLowerCase())||n.url.toLowerCase().includes(c.toLowerCase()),g=m.platform===""||n.platform===m.platform,A=m.browserName===""||n.browserName===m.browserName;return i&&g&&A});o(s),h(Math.ceil(s.length/S)),v(1)},[c,m,r,x]);const H=s=>{f(s),p(!0)},N=()=>{f([]),p(!1)},I=async()=>{const s=new D;await s.init();const n=await s.getEntries();d(n.sort((i,g)=>g.visitTime-i.visitTime))},T=s=>{j(s.target.value)},y=(s,n)=>{C(i=>({...i,[s]:n}))},B=()=>{const s=(l-1)*S;return a.slice(s,s+S)},b=s=>{v(s)},L=s=>{chrome.tabs.create({url:s})};return e.jsxs("div",{className:"history-container",children:[e.jsx("div",{className:"history-header",children:e.jsx("h2",{children:"Browsing History"})}),e.jsxs("div",{className:"search-tabs",children:[e.jsx("div",{className:`search-tab ${x?"":"active"}`,onClick:N,children:"Basic Search"}),e.jsx("div",{className:`search-tab ${x?"active":""}`,onClick:()=>p(!0),children:"Content Search"})]}),x?e.jsxs("div",{className:"content-search-container",children:[e.jsx(M,{onSearchComplete:H}),e.jsx(_,{results:k,onClearResults:N})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"history-filters",children:[e.jsx("input",{type:"text",className:"history-search",placeholder:"Search history...",value:c,onChange:T}),e.jsxs("div",{className:"filter-controls",children:[e.jsxs("select",{value:m.platform,onChange:s=>y("platform",s.target.value),className:"platform-filter",children:[e.jsx("option",{value:"",children:"All Platforms"}),w.map(s=>e.jsx("option",{value:s,children:s},s))]}),e.jsxs("select",{value:m.browserName,onChange:s=>y("browserName",s.target.value),className:"browser-filter",children:[e.jsx("option",{value:"",children:"All Browsers"}),E.map(s=>e.jsx("option",{value:s,children:s},s))]})]})]}),e.jsx("div",{className:"history-list",children:B().map(s=>e.jsxs("div",{className:"history-item",onClick:()=>L(s.url),children:[e.jsx("div",{children:s.title}),e.jsxs("div",{style:{fontSize:"0.8em",color:"#666"},children:[s.url,e.jsx("br",{}),new Date(s.visitTime).toLocaleString(),e.jsx("br",{}),e.jsxs("span",{style:{color:"#888"},children:[s.platform," â€¢ ",s.browserName]}),s.pageContent&&e.jsxs("div",{className:"page-summary",children:[e.jsx("strong",{children:"Summary:"})," ",s.pageContent.summary.substring(0,150),s.pageContent.summary.length>150?"...":""]})]})]},s.visitId))}),e.jsxs("div",{className:"pagination",children:[e.jsx("button",{onClick:()=>b(l-1),disabled:l===1,children:"Previous"}),e.jsxs("span",{children:["Page ",l," of ",u]}),e.jsx("button",{onClick:()=>b(l+1),disabled:l===u,children:"Next"})]})]})]})},q=F.createRoot(document.getElementById("root"));q.render(e.jsx($,{}));
